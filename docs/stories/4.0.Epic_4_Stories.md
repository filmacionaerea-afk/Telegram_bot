# Epic 4: Informes Inteligentes y Notificación por Telegram

**Goal:** Construir el componente final que lee la inteligencia procesada de la base de datos, la formatea en mensajes claros y los distribuye a los canales de Telegram correspondientes.

## Story 4.1: Recuperación de la Narrativa Analizada
* **As a** bot service, **I want** to query the database for the latest daily narrative and its associated data, **so that** I can prepare the content for the reports.
* **Acceptance Criteria:**
    1.  A function retrieves the latest record from `DailyNarratives`.
    2.  The function retrieves the corresponding `probability_score`.
    3.  The function retrieves the supporting posts from the `Posts` table.

## Story 4.2: Formateo del Informe Detallado para el Grupo Privado
* **As a** bot service, **I want** a function that transforms the narrative data into a Markdown-formatted text message, **so that** the report is clear and professional in the private group.
* **Acceptance Criteria:**
    1.  The output message uses Telegram formatting (bold, lists, etc.).
    2.  The message includes separate sections for the summary, sentiment, probability, supporting links, and the 5 additional probable narratives.

## Story 4.3: Envío del Informe al Grupo Privado
* **As a** bot service, **I want** to send the detailed, formatted report to the designated Telegram group, **so that** exclusive members receive the full analysis.
* **Acceptance Criteria:**
    1.  The bot sends a message using the Telegram SDK.
    2.  The destination group ID is read from the `PRIVATE_GROUP_ID` environment variable.

## Story 4.4: Envío del Resumen al Canal Público
* **As a** bot service, **I want** to send a concise, high-level message to the public channel, **so that** I can generate interest and attract new users.
* **Acceptance Criteria:**
    1.  A function formats a brief message with only the narrative title, sentiment, and probability.
    2.  The bot sends this message to the channel ID defined in `PUBLIC_CHANNEL_ID`.

## Story 4.5: Orquestación y Programación del Cron Job de Notificación
* **As a** system, **I need** the report-sending process to run automatically after the analysis, **so that** users receive timely information.
* **Acceptance Criteria:**
    1.  The main bot script orchestrates the sequence of fetching, formatting, and sending reports.
    2.  The process is scheduled as a cron job based on a `REPORTING_INTERVAL` variable.
    3.  The schedule is set to run after the analysis cron job has completed.
